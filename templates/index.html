{# templates/index.html #}
{% extends "_base.html" %}
{% set active = "/" %}
{% set page_title = "Home" %}

{% block body %}
<section class="relative h-screen before:content-[''] before:absolute before:inset-0 before:bg-[url('/static/noise.svg')] before:opacity-10">
  <div class="absolute inset-0 bg-hero-gradient"></div>
  <canvas id="particleCanvas" class="absolute inset-0"></canvas>
  <div class="relative z-10 flex flex-col items-center justify-center h-full px-6 text-center space-y-6">
    <h1 class="text-5xl sm:text-6xl font-bold text-white leading-tight" data-aos="fade-up">Upload Your Résumé in a Flash</h1>
    <p class="text-lg sm:text-xl text-gray-100 max-w-2xl" data-aos="fade-up" data-aos-delay="200">Our AI-powered recruitment assistant evaluates profiles instantly and suggests next steps</p>
    <button id="uploadCTA" class="mt-6 bg-accent text-white font-semibold rounded-lg px-8 py-4 text-lg hover:bg-accent-dark active:scale-95 transition-transform focus:ring-2 focus:ring-white" data-aos="zoom-in" data-aos-delay="400">Get Started</button>
    <input type="file" accept=".pdf,.docx" class="hidden" id="fileInput">
    <div class="absolute bottom-10 animate-bounce text-white"><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 14l-6-6h12l-6 6z" clip-rule="evenodd" /></svg></div>
  </div>
</section>

<!-- Upload + Recent cards -->
<div class="relative space-y-8">
  <div id="uploadCard" class="relative lg:-mt-24 z-20 max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-8 border border-gray-100 grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="flex flex-col items-center justify-center space-y-4" data-aos="fade-right">
      <svg class="h-12 w-12 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M12 12V4m0 0L8.5 7.5M12 4l3.5 3.5" />
      </svg>
      <p class="text-gray-700 text-lg">Drag &amp; drop a résumé (PDF/DOCX) or click below</p>
      <button id="downloadBtn" class="bg-primary text-white rounded-md px-6 py-3 hover:bg-primary-dark active:scale-95 transition focus:ring-2 focus:ring-primary">Browse files</button>
      <input type="file" id="filePicker" class="hidden" accept=".pdf,.docx">
    </div>
    <div id="mockPreview" class="hidden md:block overflow-hidden rounded-md">
      <img src="/static/mock-resume.svg" alt="Résumé preview" class="transform hover:scale-105 transition-transform duration-300 shadow-md">
    </div>
  </div>

  <div class="relative -mt-12 z-10 max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-6" data-aos="fade-up" data-aos-delay="200">
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Your Recent Uploads</h2>
    {% if resumes %}
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Name</th>
            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Added</th>
            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100">
          {% for r in resumes %}
          <tr class="hover:bg-gray-50 transition-colors" data-aos="fade-up">
            <td class="px-6 py-4 text-sm text-gray-800">{{ r.name }}</td>
            <td class="px-6 py-4 text-sm text-gray-800">{{ r.added|default('—') }}</td>
            <td class="px-6 py-4 text-sm flex items-center space-x-4">
              <button class="text-primary hover:text-primary-dark focus:outline-none"><svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg></button>
              <button class="text-secondary hover:text-secondary-dark focus:outline-none"><svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21H3v-3.5L16.732 5.232z"/></svg></button>
              <button class="text-danger hover:text-danger-dark focus:outline-none"><svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg></button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="flex flex-col items-center py-8 text-gray-500">
      <svg class="h-16 w-16 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/></svg>
      <p>No uploads yet</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
const dropZone  = document.getElementById('uploadCard');
const fileInput = document.getElementById('filePicker');
const browseBtn = document.getElementById('downloadBtn');
const heroInput = document.getElementById('fileInput');
const uploadCTA = document.getElementById('uploadCTA');

if (uploadCTA && heroInput) {
  uploadCTA.addEventListener('click', () => heroInput.click());
  heroInput.addEventListener('change', () => {
    if (heroInput.files.length) uploadFiles(heroInput.files);
  });
}


/* click → open picker */
browseBtn.onclick = () => fileInput.click();

/* picker → send via fetch */
fileInput.onchange = () => {
  if (fileInput.files.length) uploadFiles(fileInput.files);
};

/* drag-and-drop visual cues */
['dragenter','dragover'].forEach(evt =>
  dropZone.addEventListener(evt, e=>{
    e.preventDefault();
    dropZone.classList.add('border-primary');
  })
);
['dragleave','drop'].forEach(evt =>
  dropZone.addEventListener(evt, e=>{
    e.preventDefault();
    dropZone.classList.remove('border-primary');
  })
);

/* drop handler */
dropZone.addEventListener('drop', e=>{
  if (e.dataTransfer.files.length){
    uploadFiles(e.dataTransfer.files);
  }
});

/* core upload logic */
function uploadFiles(files){
  const uploads = [];
  for(const file of files){
    uploads.push(uploadSingle(file));
  }
  Promise.allSettled(uploads).then(() => {
    fileInput.value = '';
    location.reload();
  });
}

function uploadSingle(file){
  return new Promise((resolve, reject) => {
    const fd = new FormData();
    fd.append('file', file);
    const xhr = new XMLHttpRequest();
    xhr.open('POST','/upload_resume');
    xhr.onload = () => xhr.status>=200 && xhr.status<300 ? resolve() : reject();
    xhr.onerror = () => reject();
    xhr.send(fd);
  });
}

function initParticles(){
  const canvas = document.getElementById('particleCanvas');
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  let w, h;
  const particles = [];
  function resize(){
    w = canvas.width = canvas.offsetWidth;
    h = canvas.height = canvas.offsetHeight;
    particles.length = 0;
    for(let i=0;i<50;i++){
      particles.push({
        x: Math.random()*w,
        y: Math.random()*h,
        r: 1+Math.random()*3,
        vx: -0.5+Math.random(),
        vy: -0.5+Math.random()
      });
    }
  }
  function draw(){
    ctx.clearRect(0,0,w,h);
    ctx.fillStyle = 'rgba(255,255,255,0.2)';
    particles.forEach(p=>{
      p.x+=p.vx; p.y+=p.vy;
      if(p.x<0) p.x=w; if(p.x>w) p.x=0; if(p.y<0) p.y=h; if(p.y>h) p.y=0;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
    });
    requestAnimationFrame(draw);
  }
  resize();
  window.addEventListener('resize', resize);
  draw();
}

initParticles();
</script>
{% endblock %}
