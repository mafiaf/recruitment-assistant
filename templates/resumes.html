{% extends "_base.html" %}
{% set active = "/resumes" %}
{% set page_title = None %}

{% block body %}
<section class="relative">
  <div class="absolute inset-0 bg-[url('/static/grid-pattern.svg')] bg-gray-100 bg-fixed"></div>
  <div class="relative z-10 max-w-7xl mx-auto px-6 py-12 grid grid-cols-1 lg:grid-cols-4 gap-8">

    <aside class="lg:col-span-1 bg-white bg-opacity-90 rounded-xl shadow-md p-6 sticky top-24" data-aos="fade-right">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Filter Résumés</h2>
      <form class="space-y-4">
        <div>
          <label class="block text-gray-700">Search</label>
          <input id="search" type="text" placeholder="Search all fields" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:border-primary focus:ring-1 focus:ring-primary shadow-sm">
        </div>
        <div>
          <label class="block text-gray-700">Skill</label>
          <input type="text" placeholder="e.g. JavaScript" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:border-primary focus:ring-1 focus:ring-primary shadow-sm">
        </div>
        <div>
          <label class="block text-gray-700">Location</label>
          <input type="text" placeholder="e.g. Amsterdam" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:border-primary focus:ring-1 focus:ring-primary shadow-sm">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-gray-700">Min years</label>
            <input type="number" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:border-primary focus:ring-1 focus:ring-primary shadow-sm">
          </div>
          <div>
            <label class="block text-gray-700">Max years</label>
            <input type="number" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:border-primary focus:ring-1 focus:ring-primary shadow-sm">
          </div>
        </div>
        <button type="submit" class="w-full bg-primary text-white font-semibold rounded-md px-4 py-3 hover:bg-primary-dark active:scale-95 transition focus:ring-2 focus:ring-primary">Apply Filters</button>
      </form>
    </aside>

    <div class="lg:col-span-3 bg-white bg-opacity-90 backdrop-blur-sm rounded-xl shadow-md p-6" data-aos="fade-up" data-aos-delay="200">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6">Résumés</h2>
      <div class="overflow-x-auto">
        <table id="cv-table" class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Name</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Added</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-100">
            {% for r in resumes %}
            <tr class="hover:bg-gray-50 transition-colors" data-aos="zoom-in-up" data-aos-delay="300">
              <td class="px-6 py-4 text-sm text-gray-800">{{ r.name }}</td>
              <td class="px-6 py-4 text-sm text-gray-800">{{ r.added|default('—') }}</td>
              <td class="px-6 py-4 text-sm flex items-center space-x-4">
                <button class="text-primary hover:text-primary-dark focus:outline-none"><svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg></button>
                <form action="/edit_resume" method="get" class="inline">
                  <input type="hidden" name="id" value="{{ r.id }}">
                  <button class="text-secondary hover:text-secondary-dark focus:outline-none"><svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21H3v-3.5L16.732 5.232z"/></svg></button>
                </form>
                <form action="/delete_resume" method="post" class="inline" onsubmit="return confirm('Delete résumé?')">
                  <input type="hidden" name="id" value="{{ r.id }}">
                  <button class="text-danger hover:text-danger-dark focus:outline-none"><svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg></button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="mt-6 flex justify-center space-x-2">
        {% if prev_page %}
          <a href="/resumes?page={{ prev_page }}{% if qs %}&{{ qs }}{% endif %}" class="px-3 py-1 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300">{{ prev_page }}</a>
        {% endif %}
        <span class="px-3 py-1 rounded-full bg-gray-200 text-gray-700">{{ page }}</span>
        {% if next_page %}
          <a href="/resumes?page={{ next_page }}{% if qs %}&{{ qs }}{% endif %}" class="px-3 py-1 rounded-full text-gray-700 hover:bg-gray-200">{{ next_page }}</a>
        {% endif %}
      </div>
    </div>

  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
const rows = [...document.querySelectorAll('#cv-table tbody tr')];
document.getElementById('search').oninput = e => {
  const q = e.target.value.toLowerCase();
  rows.forEach(tr => {
    tr.style.display = tr.innerText.toLowerCase().includes(q) ? '' : 'none';
  });
};
</script>
{% endblock %}
